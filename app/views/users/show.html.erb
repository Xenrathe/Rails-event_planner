<div class="User">
  <h1> <%= @user.username %> </h1>

<% if current_user && current_user.id == @user.id %>
  <%= form_for @user, url: { action: "update" }, method: :patch do |f| %>
    <h2>Bio</h2>
    <div class="field">
      <%= f.text_area :bio, value: @user.bio %>
    </div>
    <h3>Timezone</h3>
    <div class="field">
      <%= f.time_zone_select :timezone %>
    </div>
    <div class="actions">
      <%= f.submit "Update" %>
    </div>
  <% end %>
<% else %>
  <h2>Bio</h2>
  <p><%= @user.bio %></p>
  <h3>Timezone</h3>
  <p><%= @user.timezone %></p>
<% end %>

  <h2><%= @user.username %>'s Adventures</h2>

  <h2>Created Adventures:</h2>
  <ul>
    <% @owned_adventures.each do |adventure|%>
      <li> <%= link_to adventure.name, adventure_path(adventure) %>
    <% end %>
  </ul>

  <% past_attendances = [] %>
  <% upcoming_attendances = [] %>
  <% @attendances.each do |attendance|%>
    <% if attendance[1].date >= Date.today %>
      <% upcoming_attendances << attendance %>
    <% else %>
      <% past_attendances << attendance %>
    <% end %>
  <% end %>

  <h2>Upcoming Adventures:</h2>
  <ul>
    <% upcoming_attendances.each do |attendance|%>
      <li> <%= attendance[1].name %> on <%= attendance[1].date %>, character: <%= attendance[0].name %>
    <% end %>
  </ul>

  <h2>Past Adventures:</h2>
  <ul>
    <% past_attendances.each do |attendance|%>
      <li> <%= attendance[1].name %> on <%= attendance[1].date %>, character: <%= attendance[0].name %>
    <% end %>
  </ul>

  <h2><%= @user.username %>'s Characters
  <% if current_user && current_user.id == @user.id %>
    <%= link_to "(New Character)", new_character_path %>
  <% end %></h2>
  <ul>
    <% @characters.each do |character|%>
      <li> <%= link_to character.name, character_path(character) %>: A level <%= character.level %> <%= character.gender %> <%= character.race %> <%= character.character_class %> (<%= character.ruleset %>)
      <% if character == @active_character %>
        <br>[active]
      <% else %>
        <br><%= link_to "[set active]", set_active_character_path(character), method: :patch, data: { turbo_method: :patch } %>
      <% end %> 
      <% if current_user && current_user.id == @user.id %>
        - <%= link_to "[edit]", edit_character_path(character) %>
      <% end %>
      </li>
    <% end %>
  </ul>

  <% if current_user && current_user.id == @user.id %>
    <%= link_to 'DELETE ACCOUNT', registration_path(current_user), method: :delete, data: { turbo_method: :delete, turbo_confirm: 'Are you sure you want to delete your account?' } %>
  <% end %>

</div>